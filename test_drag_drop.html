<!DOCTYPE html>
<html>
<head>
    <title>Drag & Drop Test</title>
    <script>
        // 時間文字列を分に変換
        const timeToMinutes = (timeStr) => {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        };
        
        // 分を時間文字列に変換
        const minutesToTime = (minutes) => {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        };
        
        // 次の利用可能な入浴時間を計算
        const getNextAvailableTime = (bathingSchedules) => {
            if (bathingSchedules.length === 0) {
                return { start_time: '10:00', end_time: '10:30' };
            }
            
            // 最後の入浴スケジュールの終了時間を取得
            const lastSchedule = bathingSchedules
                .map(schedule => ({
                    ...schedule,
                    end_time_minutes: timeToMinutes(schedule.end_time || '10:30')
                }))
                .sort((a, b) => a.end_time_minutes - b.end_time_minutes)
                .pop();
            
            const nextStartMinutes = lastSchedule.end_time_minutes;
            const nextEndMinutes = nextStartMinutes + 30; // 30分後
            
            return {
                start_time: minutesToTime(nextStartMinutes),
                end_time: minutesToTime(nextEndMinutes)
            };
        };
        
        // テストデータ
        const bathingSchedules = [
            { id: 110, title: "山田次郎さんの入浴", start_time: "09:30", end_time: "10:00" },
            { id: 102, title: "今日のテストスケジュール", start_time: "10:00", end_time: "11:00" },
            { id: 37, title: "小林さくらさん 入浴", start_time: "10:30", end_time: "11:00" },
            { id: 105, title: "田中太郎さんの入浴", start_time: "10:30", end_time: "11:00" }
        ];
        
        console.log("=== ドラッグ&ドロップ タイム計算テスト ===");
        console.log("既存の入浴スケジュール:");
        bathingSchedules.forEach(schedule => {
            console.log(`- ${schedule.title}: ${schedule.start_time}-${schedule.end_time}`);
        });
        
        const nextTime = getNextAvailableTime(bathingSchedules);
        console.log(`\n次の利用可能な時間: ${nextTime.start_time}-${nextTime.end_time}`);
        console.log("期待値: 11:00-11:30");
        console.log(`結果: ${nextTime.start_time === '11:00' && nextTime.end_time === '11:30' ? '✅ 正常' : '❌ エラー'}`);
    </script>
</head>
<body>
    <h1>Drag & Drop Time Calculation Test</h1>
    <p>コンソールを確認してください。</p>
</body>
</html>